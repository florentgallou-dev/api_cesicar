
name: Build & Tests on push develop

on:
  push:
    branches:
      - develop

permissions:
  contents: read

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Build and test
        run: |
          docker-compose -f docker-compose.yaml up --build
          docker run npm install && npm run build && composer install && php bin/console doctrine:s:u --force && php bin/console doctrine:fixtures:load && php bin/console lexik:jwt:generate-keypair && php bin/phpunit tests/Form/UserTypeTest.php
          
  # symfony-tests:
  #   runs-on: self-hosted
  #   steps:
  #   #  To automatically get bug fixes and new Php versions for shivammathur/setup-php,
  #   # change this to (see https://github.com/shivammathur/setup-php#bookmark-versioning):
  #   # uses: shivammathur/setup-php@v2
  #   - uses: shivammathur/setup-php@2cb9b829437ee246e9b3cac53555a39208ca6d28
  #     with:
  #       php-version: '8.0'
  #   - uses: actions/checkout@v3
  #   - name: Copy .env.test.local
  #     run: php -r "file_exists('.env.test.local') || copy('.env.test', '.env.test.local');"
  #   - name: Cache Composer packages
  #     id: composer-cache
  #     uses: actions/cache@v3
  #     with:
  #       path: vendor
  #       key: ${{ runner.os }}-php-${{ hashFiles('**/composer.lock') }}
  #       restore-keys: |
  #         ${{ runner.os }}-php-
  #   - name: Install Dependencies
  #     run: composer install -q --no-ansi --no-interaction --no-scripts --no-progress --prefer-dist
  #   - name: Create Database
  #     run: |
  #       mkdir -p data
  #       touch data/database.sqlite
  #   - name: Execute tests (Unit and Feature tests) via PHPUnit
  #     env:
  #       DATABASE_URL: sqlite:///%kernel.project_dir%/data/database.sqlite
  #     run: vendor/bin/phpunit
