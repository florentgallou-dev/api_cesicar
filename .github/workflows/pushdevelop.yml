name: Api Tests
run-name: ${{ github.actor }} is building - testing - deploying

on:
  push:
    branches:
      - develop

jobs:
  build:
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v3
      - run: whoami

      - name: Create env.local
        run: echo 'DATABASE_URL="mysql://api_cesicar:api_cesicar@db:3306/api_cesicar?serverVersion=mariadb-10.6.7"' > .env.local

      - name: Create env.local.test
        run: echo 'DATABASE_URL="mysql://root:root@db:3306/api_cesicar?serverVersion=mariadb-10.6.7"' > .env.test.local

      - name: Build docker container
        run: docker compose up --build

      # - name: Testing with PHPUnit
        # run: php bin/phpunit tests/ApiTest.php


 